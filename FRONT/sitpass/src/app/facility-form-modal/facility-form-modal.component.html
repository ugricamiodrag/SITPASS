<h2 mat-dialog-title>{{ facilityForm.get('name')?.value ? 'Edit Facility' : 'Create Facility' }}</h2>
<form [formGroup]="facilityForm" (ngSubmit)="onSave()" class="facility-form">
  <div class="form-row" *ngIf="isAdmin">
    <mat-form-field class="form-field">
      <mat-label>Name</mat-label>
      <input matInput formControlName="name" required>
      <mat-error *ngIf="facilityForm.get('name')?.invalid">Name is required</mat-error>
    </mat-form-field>

    <mat-form-field class="form-field">
      <mat-label>Description</mat-label>
      <input matInput formControlName="description" required>
      <mat-error *ngIf="facilityForm.get('description')?.invalid">Description is required</mat-error>
    </mat-form-field>
  </div>

  <div class="form-row" *ngIf="isAdmin">
    <mat-form-field class="form-field">
      <mat-label>Address</mat-label>
      <input matInput formControlName="address" required>
      <mat-error *ngIf="facilityForm.get('address')?.invalid">Address is required</mat-error>
    </mat-form-field>

    <mat-form-field class="form-field">
      <mat-label>City</mat-label>
      <input matInput formControlName="city" required>
      <mat-error *ngIf="facilityForm.get('city')?.invalid">City is required</mat-error>
    </mat-form-field>
  </div>

  <h3>Work Days</h3>
  <div formArrayName="workDays">
    <div *ngFor="let workDay of workDays.controls; let i=index" [formGroupName]="i" class="form-row">
      <mat-form-field class="form-field">
        <mat-label>Valid From</mat-label>
        <input matInput type="date" formControlName="validFrom" required>
      </mat-form-field>

      <mat-form-field class="form-field">
        <mat-label>Day</mat-label>
        <mat-select formControlName="day" required>
          <mat-option *ngFor="let day of daysOfWeek" [value]="day">{{ day }}</mat-option>
        </mat-select>
      </mat-form-field>


      <mat-form-field class="form-field">
        <mat-label>From</mat-label>
        <input matInput type="time" formControlName="from" required>
      </mat-form-field>

      <mat-form-field class="form-field">
        <mat-label>Until</mat-label>
        <input matInput type="time" formControlName="until" required>
      </mat-form-field>

      <button mat-icon-button type="button" (click)="removeWorkDay(i)">
        <mat-icon>remove_circle</mat-icon>
      </button>
    </div>
    <button mat-button type="button" (click)="addWorkDay()" [disabled]="workDays.length >= 7">Add Work Day</button>
  </div>

  <h3>Disciplines</h3>
  <div formArrayName="disciplines">
    <div *ngFor="let discipline of disciplines.controls; let i=index" [formGroupName]="i" class="form-row">
      <mat-form-field class="form-field">
        <mat-label>Discipline Name</mat-label>
          <input matInput formControlName="name" required>
      </mat-form-field>
      <button mat-icon-button type="button" (click)="removeDiscipline(i)">
        <mat-icon>remove_circle</mat-icon>
      </button>
    </div>
    <button mat-button type="button" (click)="addDiscipline()">Add Discipline</button>
  </div>

  <h3>Document</h3>
  <div class="form-row">
    <span *ngIf="documentFile">{{ documentFile.name }}</span>
    <input *ngIf="!documentFile" type="file" (change)="onDocumentChange($event)" accept=".pdf,.doc,.docx">
    <div *ngIf="documentFile">
      <button type="button" (click)="removeDocument()">Remove</button>
    </div>
  </div>


  <h3>Photos</h3>
  <div formArrayName="photos">
    <div *ngFor="let photo of photos.controls; let i = index">
      <img *ngIf="photoPaths[i]" [src]="photoPaths[i]" alt="Photo" width="100">
      <input *ngIf="!photoPaths[i]" type="file" (change)="onFileChange($event, i)">
      <div *ngIf="photoPaths[i]">
        <button type="button" (click)="removePhoto(i)">Remove</button>
      </div>
    </div>
    <button type="button" (click)="addPhoto()">Add Photo</button>
  </div>

  <div mat-dialog-actions class="actions">
    <button mat-button type="button" (click)="onCancel()">Cancel</button>
    <button mat-button type="submit" [disabled]="facilityForm.invalid">Save</button>
  </div>
</form>
